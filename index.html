<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Click to Pay</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
            crossorigin="anonymous"
    />
    <script src="https://qa05.gateway.mastercard.com/static/click-to-pay/click-to-pay.js"></script>
</head>
<body>
<div class="container py-3 col-md-12">
    <h2 class="text-center py-5">Click to Pay</h2>

    <div class="row">
        <div class="col-md-4">
            <div class="border rounded text-center overflow-auto" style="height: 600px; width: 410px">
                <div id="cardListContainer" style="height: 100%"></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="border rounded text-center overflow-auto" style="height: 600px; width: 410px">
                <div id="otpContainer" style="height: 100%; padding: 5px"></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="border rounded text-center overflow-auto" style="height: 600px; width: 410px">
                <div id="dcfContainer" style="height: 100%; padding: 0 8px;"></div>
            </div>
        </div>
    </div>

    <div id="checkoutComplete" class="alert alert-success d-none" style="margin-top: 50px;" role="alert"></div>
</div>

<script>
  let sessionId = 'SESSION0002192035210N39213047K7';
  let merchantId = 'SRC_TEST';
  let merchantName = 'Merchant Name';
  let merchantUrl = 'https://www.merchanturl.com';
  let wsVersion = 62;
  let paymentOptions = {};
  let orderAmount = 32.23;
  let orderCurrency = 'USD';
  let collectShippingAddress = true;
  let interactionLocale = 'en';
  let interactionCountry = 'USA';

  document.addEventListener('DOMContentLoaded', () => {
    ClickToPay.configure(configParams);
  });

  let configParams = {
    merchant: {
      id:merchantId,
      name:merchantName,
      url:merchantUrl
    },
    session: {
      id:sessionId,
      wsVersion,
      paymentOptions
    },
    order: {
      amount:orderAmount,
      currency:orderCurrency
    },
    interaction: {
      collectShippingAddress,
      locale:interactionLocale,
      country:interactionCountry
    },
    elements: {
      cardList: 'cardListContainer',
      otp: 'otpContainer',
      dcf: 'dcfContainer'
    },
    customer: {
      email: 'mtf.pvt.tester4@mailinator.com'
    },
    callbacks: {
      onStateChange: function (state) {
        console.info(state);
      },
      onError: function(e) {
        console.error(e);
      },
      onComplete: function (a, b) {
        document.getElementById('checkoutComplete').innerText = 'Checkout completed for scheme: ' + b + ' with correlation id: ' + a;
        document.getElementById('checkoutComplete').classList.remove('d-none');
      }
    }
  };

  function enrollCardHandler() {
    let unencryptedCardData = {
      primaryAccountNumber: document.getElementById('card-number').value,
      panExpirationMonth: document.getElementById('month').value,
      panExpirationYear: document.getElementById('year').value,
      cardSecurityCode: document.getElementById('cvc').value
    };

    ClickToPay.enroll(unencryptedCardData);
  }

  function verifyCardHandler() {
    tenDigitCardPrefix = document.getElementById('card-number').value.slice(0, 10);

    ClickToPay.isEnrollmentAvailable(tenDigitCardPrefix).then( response => {
      if (response){
        document.getElementById('enrollCardButton').style.display = 'inline-block';
      }
    });
  }
</script>
</body>
</html>
